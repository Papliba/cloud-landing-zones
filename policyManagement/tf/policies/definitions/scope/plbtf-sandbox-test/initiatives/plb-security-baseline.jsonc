{
  // Azure Policy Initiative: PLB Security Baseline
  // Purpose: Comprehensive security baseline for all resources
  // Combines multiple security policies into a single assignable initiative

  "name": "plb-security-baseline",

  "properties": {
    "displayName": "PLB Security Baseline Initiative",
    "description": "Comprehensive security baseline that enforces encryption, secure transfer, managed identities, and blocks public access across all Azure resources.",

    "metadata": {
      "category": "Security",
      "version": "1.0.0"
    },

    // Parameters that can be configured during initiative assignment
    "parameters": {
      "effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect for all policies",
          "description": "Enable or disable the execution of policies in this initiative"
        },
        "allowedValues": ["Audit", "Deny", "Disabled"],
        "defaultValue": "Audit"
      }
    },

    // List of policy definitions included in this initiative
    "policyDefinitions": [
      {
        // Require encryption at rest for all resources
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-encryption-at-rest",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Enforce HTTPS only for web apps
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-https-only-web-apps",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Block public blob access on storage accounts
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/block-public-blob-access",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require managed identities instead of connection strings
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-managed-identities",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Enforce minimum TLS version 1.2
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-minimum-tls-version",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Block legacy authentication protocols
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/block-legacy-authentication",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require soft delete on Key Vaults
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-soft-delete-keyvaults",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Enforce disk encryption on VMs
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-disk-encryption-vms",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Block classic resources (ASM)
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/block-classic-resources",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require Azure AD authentication for databases
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-azure-ad-auth-databases",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      }
    ]
  }
}
