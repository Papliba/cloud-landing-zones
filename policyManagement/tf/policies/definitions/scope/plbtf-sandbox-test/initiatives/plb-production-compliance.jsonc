{
  // Azure Policy Initiative: PLB Production Environment Compliance
  // Purpose: Enforce strict production environment standards
  // This initiative ensures production workloads have backup, high availability, reserved instances, and enhanced security

  "name": "plb-production-compliance",

  "properties": {
    "displayName": "PLB Production Environment Compliance Initiative",
    "description": "Comprehensive production environment baseline that enforces backup policies, high availability requirements, reserved instance usage, strict security controls, and monitoring for production workloads.",

    "metadata": {
      "category": "Compliance",
      "version": "1.0.0"
    },

    // Parameters that can be configured during initiative assignment
    "parameters": {
      "effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect for all policies",
          "description": "Enable or disable the execution of policies in this initiative"
        },
        "allowedValues": ["Audit", "Deny", "Disabled"],
        "defaultValue": "Audit"
      }
    },

    // List of production compliance policy definitions
    "policyDefinitions": [
      {
        // Require backup policies for production VMs
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-backup-policies-vms",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require reserved instances for cost optimization in production
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-reserved-instances-prod",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Block expensive VM sizes in production (cost control)
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/block-expensive-vm-sizes-prod",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require encryption at rest for data protection
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-encryption-at-rest",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require disk encryption on production VMs
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-disk-encryption-vms",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require Azure Defender for enhanced security monitoring
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-azure-defender-enabled",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require diagnostic settings for compliance logging
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-diagnostic-settings-all-resources",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require DDoS protection for production VNets
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-ddos-protection-vnets",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require soft delete on Key Vaults for data recovery
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-soft-delete-keyvaults",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Block redundant geo-replication in test environments (production only)
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/block-redundant-geo-replication-test",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require vulnerability assessment for SQL databases
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/require-vulnerability-assessment-sql",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      },
      {
        // Require SQL auditing for compliance
        "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/root-mg/providers/Microsoft.Authorization/policyDefinitions/enforce-sql-auditing",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        }
      }
    ]
  }
}
