# trigger:
#   branches:
#     include:
#     - main
#
# pool: selfhosted
#
# stages:
#   - stage: deploy-mg
#     displayName: deploy-mg
#     jobs:
#     - job: deploy-mg
#       displayName: deploy-mg
#       steps: 
#       - script: echo "Hello World"
#         displayName: "Print Hello World"
#
#       # - task: AzurePowerShell@5
#       #   inputs:
#       #     azureSubscription: 'serviceConnection'
#       #     ScriptType: 'InlineScript' # 'FilePath' | 'InlineScript'
#       #     #ScriptPath: '/script.ps1'
#       #     Inline: |
#       #         write-host "Hello from Azure PowerShell task"
#       #     #ScriptArguments: '-param1 value1 -param2 value2'
#       #     #errorActionPreference: 'stop' # 'stop' | 'continue' | 'silentlyContinue'. ErrorActionPreference. Default: stop.
#       #     #FailOnStandardError: false # boolean. Fail on Standard Error. Default: false.
#       #     #azurePowerShellVersion: # 'LatestVersion' | 'OtherVersion'.
#       #     #preferredAzurePowerShellVersion: '7.1.0'
#       #     #pwsh: false
#       #     #workingDirectory: '$(System.DefaultWorkingDirectory)'

trigger:
  branches:
    include:
    - main

pool: 'selfhosted'

stages:
  - stage: mg_deployment
    displayName: 
    jobs:
    - job: mg_deployment
      displayName: mg_deployment
      steps: 
      # AddThis to snippets
      # - script: echo "Hello World"
      #   displayName: "Print Hello World"
        - task: AzurePowerShell@5
          inputs:
            azureSubscription: 'mi-platform-mg-sc-nonprod-001'
            ScriptType: 'InlineScript' # 'FilePath'
            #ScriptPath: '/script.ps1'
            Inline: |
              Write-Host "Deploying Management Group Deployment Stack"
              new-AzManagementGroupDeploymentStack `
                -Name "testingMGstack" `
                -ManagementGroupId "c0f414ff-9e2d-4011-929c-fe21ed71b218" `
                -Location "Sweden Central" `
                -TemplateFile "$(System.DefaultWorkingDirectory)/bicep/infra/mgmtGroupStructure/mgmtGroupStructure.bicep" `
                -ActionOnUnManage 'DeleteAll' ` 
                -DenySettingsMode 'none'
            #ScriptArguments: '-param1 value1 -param2 value2'
            errorActionPreference: 'stop' # 'continue' | 'silentlyContinue'
            FailOnStandardError: false
            azurePowerShellVersion:  'LatestVersion' # 'OtherVersion'
            #preferredAzurePowerShellVersion: '7.1.0'
            pwsh: true
            workingDirectory: '$(System.DefaultWorkingDirectory)'


