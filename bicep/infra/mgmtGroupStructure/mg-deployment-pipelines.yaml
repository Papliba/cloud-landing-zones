trigger:
  branches:
    include:
    - main

pool: 'selfhosted'

stages:
- stage: mg_deploy
  displayName: 
  jobs:
  - job: dev_mg_deployment
    displayName: dev_mg_deployment
    steps: 
    - task: AzurePowerShell@5
      inputs:
        azureSubscription: 'mi-platform-mg-sc-nonprod-001'
        ScriptType: 'InlineScript' # 'FilePath'
        #ScriptPath: '/script.ps1'
        Inline: |
          Write-Host "Deploying Management Group Deployment Stack"
          new-AzManagementGroupDeploymentStack -Name "testingMGstack" -ManagementGroupId "c0f414ff-9e2d-4011-929c-fe21ed71b218" -Location "Sweden Central" -TemplateParameterFile "$(System.DefaultWorkingDirectory)/bicep/infra/mgmtGroupStructure/params/dev.bicepparam" -ActionOnUnManage 'DeleteAll' -DenySettingsMode 'none' -Force
        #ScriptArguments: '-param1 value1 -param2 value2'
        errorActionPreference: 'stop' # 'continue' | 'silentlyContinue'
        FailOnStandardError: false
        azurePowerShellVersion:  'LatestVersion' # 'OtherVersion'
        #preferredAzurePowerShellVersion: '7.1.0'
        pwsh: true
        workingDirectory: '$(System.DefaultWorkingDirectory)'
      displayName: 'Deploy MG Structure to Dev'

# - stage: stage_name
#   displayName: stage_name
#   jobs:
#   - job: dev_mg_deployment
#     displayName: dev_mg_deployment
#     steps: 
#     - task: AzurePowerShell@5
#       inputs:
#         azureSubscription: 'mi-platform-mg-sc-nonprod-001'
#         ScriptType: 'InlineScript' # 'FilePath'
#         #ScriptPath: '/script.ps1'
#         Inline: |
#           Write-Host "Deploying Management Group Deployment Stack"
#           new-AzManagementGroupDeploymentStack -Name "testingMGstack" -ManagementGroupId "c0f414ff-9e2d-4011-929c-fe21ed71b218" -Location "Sweden Central" -TemplateParameterFile "$(System.DefaultWorkingDirectory)/bicep/infra/mgmtGroupStructure/params/nonprod.bicepparam" -ActionOnUnManage 'DeleteAll' -DenySettingsMode 'none' -Force
#         #ScriptArguments: '-param1 value1 -param2 value2'
#         errorActionPreference: 'stop' # 'continue' | 'silentlyContinue'
#         FailOnStandardError: false
#         azurePowerShellVersion:  'LatestVersion' # 'OtherVersion'
#         #preferredAzurePowerShellVersion: '7.1.0'
#         pwsh: true
#         workingDirectory: '$(System.DefaultWorkingDirectory)'
#       displayName: 'Deploy MG Structure to NonProd'
#
#   - job: prod_mg_deployment
#     displayName: prod_mg_deployment
#     steps: 
#     - task: AzurePowerShell@5
#       inputs:
#         azureSubscription: 'mi-platform-mg-sc-nonprod-001'
#         ScriptType: 'InlineScript' # 'FilePath'
#         #ScriptPath: '/script.ps1'
#         Inline: |
#           Write-Host "Deploying Management Group Deployment Stack"
#           new-AzManagementGroupDeploymentStack -Name "testingMGstack" -ManagementGroupId "c0f414ff-9e2d-4011-929c-fe21ed71b218" -Location "Sweden Central" -TemplateParameterFile "$(System.DefaultWorkingDirectory)/bicep/infra/mgmtGroupStructure/params/test.bicepparam" -ActionOnUnManage 'DeleteAll' -DenySettingsMode 'none' -Force
#         #ScriptArguments: '-param1 value1 -param2 value2'
#         errorActionPreference: 'stop' # 'continue' | 'silentlyContinue'
#         FailOnStandardError: false
#         azurePowerShellVersion:  'LatestVersion' # 'OtherVersion'
#         #preferredAzurePowerShellVersion: '7.1.0'
#         pwsh: true
#         workingDirectory: '$(System.DefaultWorkingDirectory)'
#       displayName: 'Deploy MG Structure to NonProd'
